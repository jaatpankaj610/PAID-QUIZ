<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>एडमिन पैनल - पेमेंट अप्रूवल</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@400;500;600;700;800&display=swap">
    <style>
        :root {
            --primary: #4a00e0;
            --secondary: #8e2de2;
            --success: #00b894;
            --danger: #d63031;
            --warning: #fdcb6e;
            --light: #f8f9fa;
            --dark: #2d3436;
            --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans Devanagari', sans-serif;
        }
        body {
            background: #f0f2f5;
            color: var(--dark);
            line-height: 1.6;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: var(--light);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        .header {
            background: var(--gradient);
            color: var(--light);
            padding: 20px;
            border-radius: 12px 12px 0 0;
            text-align: center;
        }
        .header h1 {
            font-size: 24px;
            font-weight: 700;
        }
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        .status-filter {
            margin: 20px 0;
            text-align: center;
        }
        .status-filter button {
            background: var(--dark);
            color: var(--light);
            border: none;
            padding: 10px 15px;
            margin: 0 5px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .status-filter button.active {
            background: var(--primary);
            box-shadow: 0 4px 10px rgba(74, 0, 224, 0.3);
            transform: translateY(-2px);
        }
        #pending-requests-container {
            margin-top: 20px;
        }
        .request-card {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        .request-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .request-card h3 {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 10px;
        }
        .request-card p {
            font-size: 14px;
            margin-bottom: 6px;
        }
        .request-card .details {
            font-weight: 500;
        }
        .request-card .status {
            font-weight: 700;
            text-transform: uppercase;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
            margin-top: 10px;
        }
        .status.pending {
            background: var(--warning);
            color: var(--dark);
        }
        .status.approved {
            background: var(--success);
            color: var(--light);
        }
        .status.rejected {
            background: var(--danger);
            color: var(--light);
        }
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .actions button {
            padding: 8px 12px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .approve-btn {
            background: var(--success);
            color: var(--light);
        }
        .reject-btn {
            background: var(--danger);
            color: var(--light);
        }
        .approve-btn:hover { background: #009677; }
        .reject-btn:hover { background: #b82c2c; }
        .no-requests {
            text-align: center;
            color: #777;
            margin-top: 40px;
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 40px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-database.js"></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>एडमिन पैनल</h1>
            <p>पेंडिंग पेमेंट रिक्वेस्ट अप्रूव करें</p>
        </div>
        
        <div class="status-filter">
            <button id="show-pending-btn" class="active">पेंडिंग</button>
            <button id="show-approved-btn">अप्रूव्ड</button>
        </div>

        <div id="loader" class="loader"></div>
        
        <div id="requests-list"></div>
        
    </div>

    <script>
        const firebaseConfig = {
          apiKey: "AIzaSyDB0mVcsgSUcM7X01xcffmRBiKWRU55u_M",
          authDomain: "rajasthan-gk-quiz-41cc5.firebaseapp.com",
          databaseURL: "https://rajasthan-gk-quiz-41cc5-default-rtdb.firebaseio.com",
          projectId: "rajasthan-gk-quiz-41cc5",
          storageBucket: "rajasthan-gk-quiz-41cc5.appspot.com",
          messagingSenderId: "876482514501",
          appId: "1:876482514501:web:1ac10bc020591a5d931d2c",
          measurementId: "G-VB140B6NCW"
        };

        // Firebase को शुरू करें
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const paymentsRef = database.ref('payments');

        const requestsList = document.getElementById('requests-list');
        const loader = document.getElementById('loader');
        const showPendingBtn = document.getElementById('show-pending-btn');
        const showApprovedBtn = document.getElementById('show-approved-btn');

        let currentFilter = 'pending';

        function showLoader() {
            loader.style.display = 'block';
            requestsList.innerHTML = '';
        }

        function hideLoader() {
            loader.style.display = 'none';
        }

        function fetchPayments() {
            showLoader();
            paymentsRef.once('value', (snapshot) => {
                const payments = snapshot.val();
                requestsList.innerHTML = '';
                if (!payments) {
                    requestsList.innerHTML = '<div class="no-requests">कोई पेमेंट रिक्वेस्ट नहीं मिली।</div>';
                    hideLoader();
                    return;
                }

                const filteredPayments = Object.keys(payments).filter(key => {
                    return payments[key].status === currentFilter;
                }).map(key => ({
                    id: key,
                    ...payments[key]
                }));

                if (filteredPayments.length === 0) {
                    const message = currentFilter === 'pending' ? 'कोई पेंडिंग रिक्वेस्ट नहीं है।' : 'कोई अप्रूव्ड रिक्वेस्ट नहीं है।';
                    requestsList.innerHTML = `<div class="no-requests">${message}</div>`;
                    hideLoader();
                    return;
                }

                filteredPayments.forEach(payment => {
                    const card = createPaymentCard(payment);
                    requestsList.appendChild(card);
                });
                hideLoader();
            }, (error) => {
                console.error("Firebase डेटा पढ़ने में त्रुटि:", error);
                requestsList.innerHTML = '<div class="no-requests">डेटा लोड करने में त्रुटि।</div>';
                hideLoader();
            });
        }

        function createPaymentCard(payment) {
            const card = document.createElement('div');
            card.className = 'request-card';

            const formattedDate = new Date(payment.timestamp).toLocaleString('hi-IN', {
                day: 'numeric', month: 'long', year: 'numeric',
                hour: '2-digit', minute: '2-digit', second: '2-digit'
            });

            card.innerHTML = `
                <h3><i class="fas fa-user-circle"></i> ${payment.user_id}</h3>
                <p><strong>मोबाइल:</strong> <span class="details">${payment.mobile_number}</span></p>
                <p><strong>ट्रांजैक्शन ID:</strong> <span class="details">${payment.transaction_id}</span></p>
                <p><strong>राशि:</strong> <span class="details">₹${payment.amount}</span></p>
                <p><strong>पेमेंट नोट:</strong> <span class="details">${payment.payment_note || 'कोई जानकारी नहीं'}</span></p>
                <p><strong>दिनांक:</strong> <span class="details">${formattedDate}</span></p>
                <span class="status ${payment.status}">${payment.status === 'pending' ? 'पेंडिंग' : 'अप्रूव्ड'}</span>
            `;

            if (payment.status === 'pending') {
                const actionsDiv = document.createElement('div');
                actionsDiv.className = 'actions';
                
                const approveBtn = document.createElement('button');
                approveBtn.className = 'approve-btn';
                approveBtn.textContent = 'अप्रूव करें';
                approveBtn.onclick = () => updateStatus(payment.id, 'approved');

                const rejectBtn = document.createElement('button');
                rejectBtn.className = 'reject-btn';
                rejectBtn.textContent = 'रिजेक्ट करें';
                rejectBtn.onclick = () => updateStatus(payment.id, 'rejected');

                actionsDiv.appendChild(approveBtn);
                actionsDiv.appendChild(rejectBtn);
                card.appendChild(actionsDiv);
            }

            return card;
        }

        function updateStatus(id, newStatus) {
            showLoader();
            const updates = {};
            updates['/payments/' + id + '/status'] = newStatus;
            
            paymentsRef.update(updates)
                .then(() => {
                    console.log("Status updated successfully.");
                    fetchPayments(); // अपडेट के बाद लिस्ट को रिफ्रेश करें
                })
                .catch((error) => {
                    console.error("Status अपडेट करने में त्रुटि:", error);
                    alert("स्टेटस अपडेट करने में समस्या हुई।");
                    hideLoader();
                });
        }

        showPendingBtn.addEventListener('click', () => {
            currentFilter = 'pending';
            showPendingBtn.classList.add('active');
            showApprovedBtn.classList.remove('active');
            fetchPayments();
        });

        showApprovedBtn.addEventListener('click', () => {
            currentFilter = 'approved';
            showApprovedBtn.classList.add('active');
            showPendingBtn.classList.remove('active');
            fetchPayments();
        });

        window.addEventListener('load', fetchPayments);
    </script>
</body>
</html>
